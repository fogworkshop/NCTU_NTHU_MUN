{% extends 'frame.html' %}
{% block content %}
<div class="container-fluid">
	<div class="row title-bar-height">
		<div class="col-lg-10 col-md-9 col-sm-8 col-xs-8">
			<h2><p>Welcome to TWMUN</p></h2>
			{{meta["country"]}}<br>
			{{meta["committee"]}}
		</div>
		<div class="col-lg-2 col-md-3 col-sm-4 col-xs-4" style="text-align: right; margin-top: 18px;">
			<div class="dropdown">
				<span>{{meta["chinesename"]}}</span>
				<button class="btn btn-default dropdown-toggle" type="button" id="menu1" data-toggle="dropdown">
					<span class="glyphicon glyphicon-menu-hamburger"></span>
				</button>
				<ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="menu1">
					{% if not meta["pay"] %}
						<li role="presentation"><a role="menuitem" tabindex="-1" onclick="pay();">付款帳戶</a></li>
						{% if not (meta["nationality"] == meta["residence"] and meta["residence"] == "Taiwan") %}
						<li role="presentation"><a role="menuitem" tabindex="-1" onclick="pay_online();" >Pay Online</a></li>
						{% end %}
					{% end %}
					<li role="presentation"><a role="menuitem" tabindex="-1" onclick="upload_pp();">Upload PP</a></li>
					<li class="divider"></li>
					<li role="presentation"><a role="menuitem" tabindex="-1" onclick="changepassword();">Change Password</a></li>
					<li role="presentation"><a role="menuitem" tabindex="-1" onclick="logout();">Log Out</a></li>
				</ul>
			</div>
		</div>
	</div>
</div>
<div class="container-fluid">
</div>
<div class="hidden change-password-modal">
	<form class="form-horizontal changepassword-form">
		<div class="form-group">
			<label class="col-sm-4 control-label">Password</label>
			<div class="col-sm-7">
				<input name="opwd" class="form-control" type="password">
			</div>
		</div>	
		<div class="form-group">
			<label class="col-sm-4 control-label">New Password</label>
			<div class="col-sm-7">
				<input name="npwd" class="form-control" type="password">
			</div>
		</div>	
		<div class="form-group">
			<label class="col-sm-4 control-label">Confirm Password</label>
			<div class="col-sm-7">
				<input name="rnpwd" class="form-control" type="password">
			</div>
		</div>
		<input type="hidden" name="req" value="change">
	</form>
</div>
<div class="hidden pay-modal">
	<form class="form-horizontal pay-form">
		<div class="form-group">
			<label class="col-sm-4 control-label">帳號後五碼</label>
			<div class="col-sm-7">
				<input name="paycode" class="form-control" type="text">
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-4 control-label">繳費日期</label>
			<div class="col-sm-7">
				<input name="paydate" class="form-control" type="text" placeholder="2015/07/01">
			</div>
		</div>
		<input type="hidden" name="req" value="update_pay">
	</form>
</div>
<div class="hidden pay-online-modal">
	<a href="{{payment_url}}" target="_blank" class="btn btn-large btn-success btn-block"><h3>Go to paypal</h3></a>
	<br>
	<br>
	<form class="form-horizontal pay-form">
		<div class="form-group">
			<label class="col-sm-4 control-label">金融卡後四碼</label>
			<div class="col-sm-7">
				<input name="paycode" class="form-control" type="text">
			</div>
		</div>
		<div class="form-group">
			<label class="col-sm-4 control-label">繳費日期</label>
			<div class="col-sm-7">
				<input name="paydate" class="form-control" type="text" placeholder="2015/07/01">
			</div>
		</div>
		<input type="hidden" name="req" value="update_pay">
	</form>
</div>
<div class="hidden upload-pp-modal">
	<form name="pp" class="form-horizontal upload-pp-form">
		<div class="form-group">
			<label class="col-sm-4 control-label">檔案上傳</label>
			<div class="col-sm-7">
				<input name="pp" type="file">
			</div>
		</div>
		<input type="hidden" name="req" value="upload_pp">
	</form>
</div>
<!--href="payment_url"-->
<script>
$(document).ready(function(){
	document.title = "Homepage | TWMUN";
});

function changepassword(){
	message = $(".change-password-modal").html();
	bootbox.dialog({
		message: message,
		title: "Change Password",
		buttons: {
			success: {
				label: "Submit",
				className: "btn-success",
				callback: function() {
					data = $(".changepassword-form:visible").serialize();
					$.post("/login", data, function(msg){
						bootbox.alert(msg);
					});
				}
			},
			danger: {
				label: "Cancel",
				className: "btn-danger",
				callback: function() {
				}
			}
		}
	});
}
function logout(){
	$.post("/logout", function(){
		window.location = window.location;
	});
}
function pay(){
	message = $(".pay-modal").html();
	bootbox.dialog({
		message: message,
		title: "付款資訊",
		buttons: {
			success: {
				label: "Submit",
				className: "btn-success",
				callback: function() {
					data = $(".pay-form:visible").serialize();
					bootbox.alert(data);
					$.post("/user", data, function(msg){
						bootbox.alert(msg);
					});
				}
			},
			danger: {
				label: "Cancel",
				className: "btn-danger",
				callback: function() {
				}
			}
		}
	});
}
function pay_online(){
	message = $(".pay-online-modal").html();
	bootbox.dialog({
		message: message,
		title: "Pay Online",
		buttons: {
			success: {
				label: "Submit",
				className: "btn-success",
				callback: function() {
					data = $(".pay-form:visible").serialize();
					bootbox.alert(data);
					$.post("/user", data, function(msg){
						bootbox.alert(msg);
					});
				}
			},
			danger: {
				label: "Cancel",
				className: "btn-danger",
				callback: function() {
				}
			}
		}
	});
}
function upload_pp(){
	message = $(".upload-pp-modal").html();
	bootbox.dialog({
		message: message,
		title: "檔案上傳",
		buttons: {
			success: {
				label: "Upload",
				className: "btn-success",
				callback: function() {
                    alert('upload');
                    data = new FormData($('form[name=pp]:visible')[0]);
                    alert('upload');
                    $.ajax({
                        url: '/user',
                        type: 'POST',
                        data: data,
                        contentType: false,
                        processData: false,
                        cache: false,
                        success: function(res){
                            alert(res);
                            //window.location.reload();
                        }
                    });
				}
			},
			danger: {
				label: "Cancel",
				className: "btn-danger",
				callback: function() {
				}
			}
		}
	});
}
</script>
{% end %}

